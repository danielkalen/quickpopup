!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("quickdom"),require("smart-extend"),require("p-event"),require("promise-break"),require("@danielkalen/is"),require("detect-animation-end-helper"),require("event-lite")):"function"==typeof define&&define.amd?define(["quickdom","smart-extend","p-event","promise-break","@danielkalen/is","detect-animation-end-helper","event-lite"],e):(t=t||self).quickpopup=e(t.DOM,t.extend,t.promiseEvent,t.promiseBreak,t.IS_,t.detectAnimation,t.EventEmitter)}(this,function(t,e,n,i,s,o,r){"use strict";var a;t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,(a=s.create("natives")).load({domEl:t.isEl,quickEl:t.isQuickEl,template:t.isTemplate});var l,c,d=a,p=t.template(["div",{ref:"popup",style:{position:"absolute",zIndex:1e4,top:0,left:0,width:"100vw",height:0,minHeight:"100%",visibility:"hidden",overflow:"hidden",transition:function(t){return`all 0.001s linear ${t.settings.animation+1}ms`},$open:{transition:function(){return"all 0.001s linear 0s"},visibility:"visible",overflow:"visible",height:"auto"}}}]),h=t.template(["div",{ref:"overlay",style:{position:"fixed",zIndex:1,left:0,top:0,width:"100vw",minHeight:"100vh",opacity:0,backgroundColor:function(t){return t.settings.overlayColor},transition:function(t){return`opacity ${t.settings.animation}ms`},$open:{opacity:1}}}]),u=t.template(["div",{ref:"content",style:{position:"absolute",zIndex:2,boxSizing:"border-box",maxWidth:"100%",margin:"0 auto",padding:function(t){return t.settings.contentPadding},opacity:0,transition:function(t){var e;return`transform ${e=t.settings.animation}ms, -webkit-transform ${e}ms, opacity ${e}ms`},$open:{opacity:1,_:0},$centerPlacement:{left:"50%",transform:"translateX(-50%)"},$topPlacement:{top:0,left:"50%",transform:"translateX(-50%) translateY(-100%)",$open:{transform:"translateX(-50%) translateY(0)",_:1}},$bottomPlacement:{bottom:0,left:"50%",transform:"translateX(-50%) translateY(100%)",$open:{transform:"translateX(-50%) translateY(0)",_:2}}},computers:{placement:function(t){return this.state(`${t}Placement`,!0)},content:function(t){if(t)return this.append(t)}},events:{"stateChange:visible":function(e){if(e&&"center"===t(this).related.settings.placement)return t(this).related.alignToCenter()}}}]),f=t.template(["div",{ref:"close",style:{position:"absolute",display:function(t){return t.settings.close.show?"block":"none"},top:function(t){return t.settings.close.inside?t.settings.close.padding:2.5*t.settings.close.size*-1},right:function(t){return t.settings.close.inside?t.settings.close.padding:0},width:function(t){return t.settings.close.size},height:function(t){return t.settings.close.size},color:function(t){return t.settings.close.color}}},["*svg",{attrs:{viewBox:"0 0 492 492"},style:{width:"100%",height:"100%"}},["*path",{attrs:{d:"M300.2 246L484.1 62c5.1-5.1 7.9-11.8 7.9-19 0-7.2-2.8-14-7.9-19L468 7.9c-5.1-5.1-11.8-7.9-19-7.9 -7.2 0-14 2.8-19 7.9L246 191.8 62 7.9c-5.1-5.1-11.8-7.9-19-7.9 -7.2 0-14 2.8-19 7.9L7.9 24c-10.5 10.5-10.5 27.6 0 38.1L191.8 246 7.9 430c-5.1 5.1-7.9 11.8-7.9 19 0 7.2 2.8 14 7.9 19l16.1 16.1c5.1 5.1 11.8 7.9 19 7.9 7.2 0 14-2.8 19-7.9l184-184 184 184c5.1 5.1 11.8 7.9 19 7.9h0c7.2 0 14-2.8 19-7.9l16.1-16.1c5.1-5.1 7.9-11.8 7.9-19 0-7.2-2.8-14-7.9-19L300.2 246z"},style:{fill:function(t){return t.settings.close.color}}}]]]),g=t.template(["div",{id:"bodyWrapper",passStateToChildren:!1,style:{$open:{position:"fixed",width:"100%",top:"0"}}}]),m=t.template(["div",{computers:{html:function(t){return this.html=t}}}]),y=Object.freeze({__proto__:null,popup:p,overlay:h,content:u,close:f,bodyWrapper:g,html:m}),w=function(t,n){return e.filter({placement:d.string,template:d.objectPlain,condition:d.function,animation:d.number,overlayColor:d.string,open:d.objectPlain,close:d.objectPlain,triggers:d.objectPlain}).clone.deep.notDeep("content")(t,n)},v=function(t){return setTimeout(function(){if(window.scroll(0,0),t)return setTimeout(function(){return v()},t)})},b=function(){return window.scrollY-$()},$=function(){var t;return((null!=(t=document.body.getBoundingClientRect())?t.top:void 0)||0)+window.scrollY},k=function(){switch(!1){case!d.defined(document.hidden):return{hidden:"hidden",visibilitychange:"visibilitychange"};case!d.defined(document.msHidden):return{hidden:"msHidden",visibilitychange:"msvisibilitychange"};case!d.defined(document.webkitHidden):return{hidden:"webkitHidden",visibilitychange:"webkitvisibilitychange"};default:return{}}},O=document.all&&!window.atob,E=window.navigator.msPointerEnabled,P=/Edge/.test((null!=(l=window.navigator)?l.userAgent:void 0)||"");c=t(document.body);var x,W=function(){class e extends r{static wrapBody(){var t,e,n,i,s;if(!(null!=(s=this.bodyWrapper)?s.parent:void 0))for(this.bodyWrapper=g.spawn(),t=c.children.slice(),this.bodyWrapper.prependTo(c),n=0,i=t.length;n<i;n++)e=t[n],this.bodyWrapper.append(e)}static unwrapBody(){var t,e,n,i;if(this.bodyWrapper){for(n=0,i=(t=this.bodyWrapper.children.slice()).length;n<i;n++)e=t[n],c.append(e);return this.bodyWrapper.remove(),this.bodyWrapper=null}}static destroyAll(){var t,e,n;for(t=0,n=(e=this.instances.slice()).length;t<n;t++)e[t].destroy();return this.unwrapBody()}constructor(n,i,s){super(),this.template=s,this.settings=w(i,n),this.id=Math.round(1e5*Math.random()).toString(16),this.state={open:!1,destroyed:!1,offset:0,count:0},this.settings.content&&(this.content=t(this.settings.content)),e.instances.push(this),e.wrapBody(),this._createElements(),this._attachBindings(),this.settings.template&&"object"==typeof this.settings.template&&this._applyTemplate(),this.el.prependTo(c),this.settings.open&&this.open()}_createElements(){var t,e,n;if(n={data:{content:this.content,placement:this.settings.placement}},t={relatedInstance:this},this.el=this.template.popup.spawn(n,t),this.template.overlay.spawn(n,t).appendTo(this.el),e=this.template.content.spawn(n,t).appendTo(this.el),this.settings.close.show)return this.template.close.spawn(n,t).appendTo(e)}_applyTemplate(){var t,e;for(e in t=this.settings.template,this.el.child)t[e]&&this.el.child[e].updateOptions(t[e])}_attachBindings(){var e,n,i,s,o;if(e=this.close.bind(this),this.el.child.overlay.on("mouseup touchend",e),null!=(i=this.el.child.close)&&i.on("mouseup touchend",e),"center"===this.settings.placement&&t(window).on(`resize.${this.id}`,()=>{if(this.state.open)return this.alignToCenter()}),this.settings.triggers.close.esc&&t(document).on(`keyup.${this.id}`,t=>{if(27===t.keyCode&&this.state.open)return t.stopPropagation(),t.preventDefault(),this.close()}),this.settings.triggers.open.visibility&&(({visibilitychange:o,hidden:n}=k()),t(document).on(`${o}.${this.id}`,()=>{if(document[n])return this.open("visibility")})),this.settings.triggers.open.exitIntent&&t(document).on(`mouseout.${this.id}`,t=>{var e,n;if(e=O||E||P?110:0,n=this.settings.yThreshold+e,t.clientY<=n)return this.open("exitIntent")}),this.settings.triggers.open.navigation&&(null!=(s=window.history)?s.pushState:void 0))return window.history.replaceState({id:"quickpopup-origin"},"",""),window.history.pushState({id:"quickpopup"},"",""),t(window).on(`popstate.${this.id}`,t=>{if("quickpopup-origin"!==t.state.state.id||!this.open("navigation"))return window.history.back()})}_detachBindings(){var e,n,i;if(this.el.child.overlay.off(),null!=(n=this.el.child.close)&&n.off(),({visibilitychange:i,hidden:e}=k()),"center"===this.settings.placement&&t(window).off(`resize.${this.id}`),this.settings.triggers.open.navigation&&t(window).off(`popstate.${this.id}`),this.settings.triggers.open.exitIntent&&t(document).off(`mouseout.${this.id}`),this.settings.triggers.open.visibility&&t(document).off(`${i}.${this.id}`),this.settings.triggers.close.esc)return t(document).off(`keyup.${this.id}`)}_throwDestroyed(){throw new Error("invalid attempt to operate a destroyed popup instance")}setContent(e){return this.content=function(){switch(!1){case!d.quickEl(e):return e;case!d.domEl(e):return t(e);case!d.template(e):return e.spawn();case!d.string(e):return m.spawn({data:{html:e}});default:throw new Error("invalid target provided to Popup::setContent()")}}(),this.el.child.content.children.length?this.el.child.content.children[1].replaceWith(this.content):this.el.child.content.append(this.content)}alignToCenter(){var t,e,n;return e=(t=this.el.child.content.raw.clientHeight)>=(n=window.innerHeight)-80?window.innerWidth>736?100:60:(n-t)/2,this.el.child.content.style("margin",`${e}px auto`)}open(t){return Promise.resolve().then(()=>{if(this.state.destroyed&&this._throwDestroyed(),this.state.open||e.hasOpen&&!this.settings.forceOpen||++this.state.count>=this.settings.openLimit||window.innerWidth<this.settings.triggers.open.minWidth||this.settings.condition&&!this.settings.condition())return i()}).then(()=>{var n;return this.emit("beforeopen",t),e.hasOpen?(n=e.instances.filter(t=>t!==this&&t.state.open),Promise.all(n.map(t=>(this.state.offset=t.state.offset,t.close(!0))))):this.state.offset=b()}).then(()=>{var i;return v(5),e.bodyWrapper.state("open",!0),e.bodyWrapper.style("top",-1*this.state.offset),this.el.state("open",!0),this.state.open=e.hasOpen=!0,"center"===this.settings.placement&&this.alignToCenter(),this.emit("open",t),this.settings.animation&&e.transitionEnd?(i=n(this,"finishopen"),this.el.child.content.on(e.transitionEnd,t=>{if(t.target===this.el.child.content.raw)return this.emit("finishopen"),this.el.child.content.off(e.transitionEnd)}),i):this.emit("finishopen")}).catch(i.end).then(()=>this)}close(t){return Promise.resolve().then(()=>{if(!this.state.open)return i()}).then(()=>{var i;return this.emit("beforeclose"),!0!==t&&(setTimeout(()=>{var t,n;if(!e.hasOpen)return null!=(t=e.bodyWrapper)&&t.state("open",!1),null!=(n=e.bodyWrapper)&&n.style("top",null),window.scroll(0,this.state.offset+$())}),e.hasOpen=!1),this.el.state("open",!1),this.state.open=!1,this.emit("close"),this.settings.animation&&e.transitionEnd?(i=n(this,"finishclose"),this.el.child.content.on(e.transitionEnd,t=>{if(t.target===this.el.child.content.raw)return this.emit("finishclose"),this.el.child.content.off(e.transitionEnd)}),i):this.emit("finishclose")}).catch(i.end).then(()=>this)}destroy(){return this.settings.destroyed&&this._throwDestroyed(),this.close(),this._detachBindings(),this.el.remove(),e.instances.splice(e.instances.indexOf(this),1),!0}}return e.instances=[],e.hasOpen=!1,e.bodyWrapper=null,e.transitionEnd=o("transition"),e}.call(void 0);return(x=function(n,i){var s;return(s=function(e){switch(!1){case 0!==arguments.length:return new W(null,n,i);case"string"!=typeof e:return new W({content:m.spawn({data:{html:e}})},n,i);case!t.isEl(e):case!t.isQuickEl(e):return new W({content:e},n,i);case!t.isTemplate(e):return new W({content:e.spawn()},n,i);case!(e&&"object"==typeof e):return new W(e,n,i);default:throw new Error("invalid argument provided to QuickPopup")}}).config=function(t,s){var o,r,a,l;if(!d.object(t))throw new Error(`QuickPopup Config: invalid config object provided ${String(t)}`);if(r=e.clone.deep(n,t),d.object(s))for(o in a=Object.create(null),i)l=i[o],s[o]?a[o]=l.extend(s[o]):a[o]=l;else a=i;return x(r,a)},s.wrapBody=function(){return W.wrapBody()},s.unwrapBody=function(){return W.unwrapBody()},s.destroyAll=function(){return W.destroyAll()},s.version="1.0.0",s.defaults=n,s.templates=i,s})({placement:"center",open:!1,forceOpen:!1,template:null,condition:null,animation:300,contentPadding:0,yThreshold:15,openLimit:Infinity,overlayColor:"rgba(0,0,0,0.88)",close:{show:!1,padding:20,inside:!1,size:22},triggers:{open:{navigation:!1,visibility:!1,exitIntent:!1},close:{esc:!0}}},y)});